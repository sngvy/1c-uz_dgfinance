&НаСервере
Процедура ОтправитьСМСНаСервере()
	// Получим непредопределенное значение с сервера
	ЭтаФорма.РезультатОтправлено = Справочники.РезультатыМероприятий.НайтиПоНаименованию("Отправлено");
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьСМС(Команда)
	ОтправитьСМСНаСервере();
	// Выполняем обычную клиентскую процедуру
	Если КонтрольСобытий.КонтрольЧасовогоПояса(Объект.Должник) Тогда
		Возврат;
	КонецЕсли;
	
	Если КонтрольСобытий.КонтрольСМС(Объект.Должник) Тогда
		Возврат;
	КонецЕсли;	
	
	НоваяЗадача = ПолучитьФорму("Задача.Мероприятие.Форма.ФормаМероприятия", Новый Структура("Объект", Объект.Ссылка));
    НоваяЗадача.Объект.Объект = ЭтаФорма.Объект.Ссылка;
	НоваяЗадача.Объект.ТипМероприятия = ПредопределенноеЗначение("Справочник.ТипыМероприятий.ОтправкаСМС");
	НоваяЗадача.Объект.Результат = РезультатОтправлено;
	// НоваяЗадача.Объект.Контакт = РезультатНомер;
	НоваяЗадача.КонтрагентКЛ = ЭтаФорма.Должник;
    НоваяЗадача.Открыть();
	ФормаСМС = ПолучитьФорму("Обработка.бит_Битфон.Форма.ОтправкаСМС");
	// ФормаСМС.ВладелецФормы = ЭтаФорма;
	стрСМСЛогин = "";
	стрСМСПароль = "";
	стрОтправитель = "";
	Автоинформирование.ПолучитьПараметрыОтправкиСМС(стрСМСЛогин, стрСМСПароль, стрОтправитель);
	ФормаСМС.СМСЛогин = стрСМСЛогин;
	ФормаСМС.СМСПароль = стрСМСПароль;
	Если ЗначениеЗаполнено(стрОтправитель) Тогда
		ФормаСМС.Элементы.Отправитель.СписокВыбора.Добавить(стрОтправитель);
		ФормаСМС.Отправитель = стрОтправитель;
	КонецЕсли;
	ФормаСМС.НомерПолучателя = Элементы.ДолжникТелефоны.ТекущиеДанные.Номер;
	ФормаСМС.Договор = ЭтаФорма.Объект.Ссылка; 
	ФормаСМС.ТекстСМС = Автоинформирование.ПолучитьПодсказку(Объект.Ссылка, ОбъектыСервер.РазыменоватьСсылку(ПредопределенноеЗначение("Справочник.ТипыМероприятий.ОтправкаСМС"), "ШаблонСМС"));
	ФормаСМС.Открыть();
КонецПроцедуры
