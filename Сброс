&НаКлиенте
Процедура ЗавершитьРазговор(Команда)
	Попытка
		ФормаНабора = ПолучитьФорму("Обработка.бит_Битфон.Форма.ОсновнаяФорма");
		Если ФормаНабора.ИдетРазговор = Истина Тогда
			ФормаНабора.КнОтбой(Неопределено);
		КонецЕсли;
	Исключение
		Предупреждение("БИТ.Phone не подключен!");
	КонецПопытки
КонецПроцедуры

Для обработки оповещений:
	Если ИмяСобытия = "ДлительностьИзменилась" Тогда 
		ФормаНабора = ПолучитьФорму("Обработка.бит_Битфон.Форма.ОсновнаяФорма");
		// Сообщить длительность разговора
		ЭтаФорма.ДлительностьРазговора = ФормаНабора.ДлительностьРазговора;
		Если ЭтаФорма.ДлительностьРазговора <> "00:00:00" Тогда
			Пояснение = "Разговор завершен. Длительность разговора"+ЭтаФорма.ДлительностьРазговора;
			ПоказатьОповещениеПользователя("БИТ.Phone",,Пояснение,БиблиотекаКартинок.Информация32);
		КонецЕсли;
	КонецЕсли;

Для АТС:
	// Обработчик состояния звонка
	Если Состояние = "ЗвонокПрерван" Тогда
		ЭтаФорма.ЗвонокПрерван = Истина;
		ЭтаФорма.КнОтбой(Неопределено);
	КонецЕсли;
	
	Если Состояние = "ЗвонокПрерван" Тогда
		Оповестить("ДлительностьИзменилась");
	КонецЕсли;
	
	// Костыль для Бит
	ОбновитьСтатусАбонентаSIP(Неопределено);
	
	// Обработчик состояния звонка
	Если ЭтаФорма.ЗвонокПрерван = Истина И ЭтаФорма.ДлительностьРазговора <> "00:00:00" Тогда
		ЭтаФорма.КнОтключить(Неопределено);
		ЭтаФорма.ЗвонокПрерван = Ложь;
	КонецЕсли;
		
	// Костыль для Бит	
	Если ЭтаФорма.ЗвонокПрерван = Истина И ЭтаФорма.ДлительностьРазговора = "00:00:00" Тогда
		СтрокаЗапроса = "ping -n 1 -w "+Формат(1000 * 3, "ЧДЦ=0; ЧГ=") + " 127.0.0.1"; 
		WshShell = Новый COMОбъект("WScript.Shell"); 
		WshShell.Run(СтрокаЗапроса, 0, -1);
		ЭтаФорма.КнОтключить(Неопределено);
		ЭтаФорма.ЗвонокПрерван = Ложь;	
	КонецЕсли;
