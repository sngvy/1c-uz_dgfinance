&НаКлиенте
Процедура ЗавершитьРазговор(Команда)
	Попытка
		ФормаНабора = ПолучитьФорму("Обработка.бит_Битфон.Форма.ОсновнаяФорма");
		Если ФормаНабора.ИдетРазговор = Истина Тогда
			ФормаНабора.КнОтбой(Неопределено);
		КонецЕсли;
	Исключение
		Предупреждение("БИТ.Phone не подключен!");
	КонецПопытки
КонецПроцедуры

Для обработки оповещений:
	Если ИмяСобытия = "ДлительностьИзменилась" Тогда 
		ФормаНабора = ПолучитьФорму("Обработка.бит_Битфон.Форма.ОсновнаяФорма");
		// Сообщить длительность разговора
		ЭтаФорма.ДлительностьРазговора = ФормаНабора.ДлительностьРазговора;
		Если ЭтаФорма.ДлительностьРазговора = "0:00:00" Тогда
			ПоказатьОповещениеПользователя("БИТ.Phone",,"Звонок был сброшен",БиблиотекаКартинок.Предупреждение32);
		КонецЕсли;
		Если ЭтаФорма.ДлительностьРазговора <> "0:00:00" Тогда
			Пояснение = "Разговор завершен. Длительность разговора "+ЭтаФорма.ДлительностьРазговора;
			ПоказатьОповещениеПользователя("БИТ.Phone",,Пояснение,БиблиотекаКартинок.Информация32);
		КонецЕсли;
	КонецЕсли;

Для АТС:
	//////////////////////////////////
	// Обработчик состояния звонка //
	////////////////////////////////
	
	Если Состояние = "ЗвонокПрерван" Тогда
		// Сохранить состояние последнего звонка
		ЭтаФорма.ЗвонокПрерван = Истина;
		// Сообщить длительность через форму мероприятия
		Оповестить("ДлительностьИзменилась");
		// Занять линию
		ЭтаФорма.СтатусСвободен = Ложь;
		// Попытаться получить статус незанятой линии
		Пока ЭтаФорма.СтатусСвободен = Ложь Цикл
			ОбновитьСтатусАбонентаSIP(Неопределено);
			// Проверка освобождения линии
			Если ЭтаФорма.СтатусСвободен = Истина Тогда
				Прервать;
			КонецЕсли;
		КонецЦикла;
		// Отключить оператора и очистить состояние последнего звонка
		Если ЭтаФорма.ЗвонокПрерван = Истина Тогда
			ЭтаФорма.КнОтключить(Неопределено);
			ЭтаФорма.ЗвонокПрерван = Ложь;
		КонецЕсли;
	КонецЕсли;
	
			// Обновить статус оператора 
			ЭтаФорма.СтатусСвободен = Истина;

